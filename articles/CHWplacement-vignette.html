<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CHWplacement • CHWplacement</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="CHWplacement">
<meta property="og:description" content="CHWplacement">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CHWplacement</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/CHWplacement-vignette.html">CHWplacement</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="CHWplacement-vignette_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>CHWplacement</h1>
            <h3 data-toc-skip class="subtitle">A package to compute optimal CHW geographical placement scenarios</h3>
            
      
      
      <div class="hidden name"><code>CHWplacement-vignette.Rmd</code></div>

    </div>

    
    
<p>This R package contains functions that can be used to compute CHW placement scenarios, based on gridded population surfaces, friction surfaces and additional datasets such as GPS coordinates of existing health facilities.</p>
<p>These functions are based on the CLSCP optimisation programme by <span class="citation">Current and Storbeck (1988)</span>. Further details on the methodology can be found in the associated manuscript.</p>
<p><img src="model_cartoon.PNG" width="60%"></p>
<p>The CHW placement scenarios are designed to find the minimum number of CHWs required to reach full population coverage under two constraints:</p>
<ol style="list-style-type: decimal">
<li><p>the travel time between the CHWs and the households remains below a given time</p></li>
<li><p>the population assigned to each CHW remains below a given threshold</p></li>
</ol>
<p>The algorithm provides the total number of CHWs required and their GPS positions.</p>
<div class="section level2">
<h2 id="how-to-use-the-package">How to use the package<a class="anchor" aria-label="anchor" href="#how-to-use-the-package"></a>
</h2>
<div class="section level3">
<h3 id="first-steps-and-preparation-of-model-inputs">First steps and preparation of model inputs<a class="anchor" aria-label="anchor" href="#first-steps-and-preparation-of-model-inputs"></a>
</h3>
<p>First the package needs to be loaded.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">CHWplacement</span><span class="op">)</span>
<span class="co">#library(igraph)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-forge.r-project.org/projects/rgeos/" class="external-link">rgeos</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: sp</span>
<span class="co">#&gt; rgeos version: 0.5-9, (SVN revision 684)</span>
<span class="co">#&gt;  GEOS runtime version: 3.8.0-CAPI-1.13.1 </span>
<span class="co">#&gt;  Please note that rgeos will be retired by the end of 2023,</span>
<span class="co">#&gt; plan transition to sf functions using GEOS at your earliest convenience.</span>
<span class="co">#&gt;  Linking to sp version: 1.4-7 </span>
<span class="co">#&gt;  Polygon checking: TRUE</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://oscarperpinan.github.io/rastervis/" class="external-link">rasterVis</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: lattice</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/" class="external-link">cowplot</a></span><span class="op">)</span></code></pre></div>
<p>The optimisation requires 5 inputs:</p>
<ul>
<li><p><strong>population.raster</strong>: a population gridded surface, representing population distribution</p></li>
<li><p><strong>friction.raster</strong>: a friction surface (for example, the surface by <span class="citation">Weiss et al. (2020)</span> that can be downloaded from the malariaAtlas R package <span class="citation">Pfeffer et al. (2018)</span>), representing the difficulty to cross one pixel in the maps (e.g. in minutes to cross one meter)</p></li>
<li><p><strong>access.raster</strong>: a raster surface indicating areas to be included in the algorithm, e.g. accessibility to health facilities (for example, the surface by <span class="citation">Weiss et al. (2020)</span> that can be downloaded from the malariaAtlas R package <span class="citation">Pfeffer et al. (2018)</span>)</p></li>
<li><p><strong>popurb.raster</strong>: a raster surface indicating the positioning of urban areas (for example, as derived using the DefineUrban function)</p></li>
<li><p><strong>shp</strong>: a polygon shapefile indicating the area to be considered for optimisation</p></li>
</ul>
<p>For this example, we will demonstrate with fictitious data, but the user’s data should be used instead.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R">
  <span class="va">newproj</span><span class="op">=</span> <span class="st">"+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84"</span>
  <span class="va">pop.dummy</span><span class="op">=</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html" class="external-link">raster</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">30</span>,<span class="fl">125</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">90</span>,<span class="fl">100</span><span class="op">)</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">15</span><span class="op">)</span><span class="op">)</span>
  <span class="va">fric.dummy</span><span class="op">=</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html" class="external-link">raster</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.02</span>,<span class="fl">225</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">15</span><span class="op">)</span><span class="op">)</span>
  <span class="va">acc.dummy</span><span class="op">=</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html" class="external-link">raster</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">30</span>,<span class="fl">175</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">90</span>,<span class="fl">50</span><span class="op">)</span><span class="op">)</span>, byrow<span class="op">=</span><span class="cn">T</span>, ncol<span class="op">=</span><span class="fl">15</span><span class="op">)</span><span class="op">)</span>
  <span class="va">shp.dummy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extent.html" class="external-link">extent</a></span><span class="op">(</span><span class="va">pop.dummy</span><span class="op">)</span>, <span class="st">'SpatialPolygons'</span><span class="op">)</span>
  <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/projection.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">pop.dummy</span><span class="op">)</span><span class="op">=</span><span class="va">newproj</span>
  <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/projection.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">fric.dummy</span><span class="op">)</span><span class="op">=</span><span class="va">newproj</span>
  <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/projection.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">acc.dummy</span><span class="op">)</span><span class="op">=</span><span class="va">newproj</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">acc.dummy</span><span class="op">)</span><span class="op">=</span><span class="st">""</span>
  </code></pre></div>
<p>The raster file indicating the position of urban areas can be created following the “degree of urbanization approach” described in the 2017 World Bank report <span class="citation">(2017)</span> to define urban and rural areas, with the <strong>DefineUrban</strong> function. The parameter <strong>rururb_cutoff</strong> indicates the minimum population density for each pixel considered as urban. The parameter <strong>min_urbsize</strong> indicates the minimum population in the total area of contiguous selected pixels to be considered as urban. The user can also use any raster file created with another methodology.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R">
  <span class="va">urb.dummy</span> <span class="op">=</span> <span class="fu"><a href="../reference/DefineUrban.html">DefineUrban</a></span><span class="op">(</span> <span class="va">pop.dummy</span>, rururb_cutoff <span class="op">=</span> <span class="fl">50</span>, min_urbsize <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span>
<span class="co">#&gt; Loading required namespace: igraph</span>
<span class="co">#&gt; [1] "Proportion of the population in urban areas is 70.59%"</span></code></pre></div>
<p>We can first visualise this fictitious data, using the following plotting packages:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">plot_pop</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/gplot-methods.html" class="external-link">gplot</a></span><span class="op">(</span><span class="va">pop.dummy</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#FF6600"</span>, <span class="st">"#990000"</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"Population"</span><span class="op">)</span>

<span class="va">plot_acc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/gplot-methods.html" class="external-link">gplot</a></span><span class="op">(</span><span class="va">acc.dummy</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"forestgreen"</span>, <span class="st">"darkorange"</span><span class="op">)</span>, name<span class="op">=</span><span class="st">"Access"</span><span class="op">)</span>

<span class="va">plot_urb</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/gplot-methods.html" class="external-link">gplot</a></span><span class="op">(</span><span class="va">urb.dummy</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span> values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#990000"</span><span class="op">)</span>, name<span class="op">=</span><span class="st">"Urban\npopulation"</span><span class="op">)</span>

<span class="va">plot_fric</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/gplot-methods.html" class="external-link">gplot</a></span><span class="op">(</span><span class="va">fric.dummy</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#FFCC00"</span><span class="op">)</span>, name<span class="op">=</span><span class="st">"Friction"</span><span class="op">)</span></code></pre></div>
<p>In this fictitious population, we have 12750 people, 9000 of them living in an urban area. The southern areas is considered to be hard-to-reach (orange, as opposed to green). This represents 720 individuals in the rural area, and 2340 in the urban area. The friction is uniform.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">plot_pop</span>, <span class="va">plot_fric</span>, <span class="va">plot_acc</span>, <span class="va">plot_urb</span><span class="op">)</span></code></pre></div>
<p><img src="CHWplacement-vignette_files/figure-html/unnamed-chunk-5-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="creating-a-chw-placement-scenario-on-a-simple-example">Creating a CHW placement scenario on a simple example<a class="anchor" aria-label="anchor" href="#creating-a-chw-placement-scenario-on-a-simple-example"></a>
</h3>
<p>These elements are combined to provide the minimal number of CHWs and their optimal geographical positioning to guarantee full population coverage verifying the following constraints:</p>
<ul>
<li><p><strong>Maximum travel time</strong>: the travel time between the CHW and their assigned inhabitants remains below a certain time (called “radius”)</p></li>
<li><p><strong>Maximium population</strong>: the maximal number of inhabitant per CHWs remains below a certain capacity threshold, that can differ in urban (“max.treat.per.CHW.urban”) and rural (“max.treat.per.CHW.rural”) areas</p></li>
<li><p><strong>Area selection</strong>: the analysis can be restricted to certain areas in the access.raster map via the “buffer” and “is.inside” parameters: for example if access.raster represents the travel time to health facilities in min, the analysis can restricted to areas situated at more than 60 min from any health facility (buffer=60 and is.inside=FALSE), or areas situated at less than 60 min from from any health facility (buffer=60 and is.inside=TRUE)</p></li>
</ul>
<p>The CHW plan can be defined with the following function:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="../reference/CreateCHWplacement.html">CreateCHWplacement</a></span><span class="op">(</span> population.raster<span class="op">=</span><span class="va">pop.dummy</span>, friction.raster<span class="op">=</span><span class="va">fric.dummy</span>,shp<span class="op">=</span><span class="va">shp.dummy</span>,
                     name<span class="op">=</span><span class="st">"temp"</span>, buffer<span class="op">=</span><span class="fl">60</span>, radius<span class="op">=</span><span class="fl">600</span>, capacity.name<span class="op">=</span><span class="st">""</span>,
                     access.raster<span class="op">=</span><span class="va">acc.dummy</span>,popurb.raster<span class="op">=</span><span class="va">urb.dummy</span>,
                     max.treat.per.CHW.urban<span class="op">=</span><span class="fl">2000</span>, max.treat.per.CHW.rural<span class="op">=</span><span class="fl">1000</span>,
                     max.CHW.per.pixel<span class="op">=</span><span class="fl">10</span>, is.inside <span class="op">=</span> <span class="cn">FALSE</span>, filepath<span class="op">=</span><span class="st">"."</span><span class="op">)</span>
<span class="co">#&gt; Warning in raster::projectRaster(friction.map, pop.map): input and ouput crs are</span>
<span class="co">#&gt; the same</span>
<span class="co">#&gt; Warning in raster::projectRaster(access.map, pop.map): input and ouput crs are</span>
<span class="co">#&gt; the same</span>
<span class="co">#&gt; Model name: </span>
<span class="co">#&gt;   a linear program with 2550 decision variables and 100 constraints</span></code></pre></div>
<p>This function will create a file called temp.mps, stored in the repository indicated by filepath. This files contains the description of the optimisation problem, that can then be solved by an optimisation algorithm. For example, the problem can be solved in R with the lpSolveAPI package, with the following function:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">CHWanswer</span><span class="op">=</span><span class="fu"><a href="../reference/solve_CHWplacement.html">solve_CHWplacement</a></span><span class="op">(</span>population.raster<span class="op">=</span><span class="va">pop.dummy</span>, friction.raster<span class="op">=</span><span class="va">fric.dummy</span>,shp<span class="op">=</span><span class="va">shp.dummy</span>,
                                        name<span class="op">=</span><span class="st">"temp"</span>, buffer<span class="op">=</span><span class="fl">60</span>, radius<span class="op">=</span><span class="fl">600</span>, capacity.name<span class="op">=</span><span class="st">""</span>,
                                        access.raster<span class="op">=</span><span class="va">acc.dummy</span>,popurb.raster<span class="op">=</span><span class="va">urb.dummy</span>,
                                        is.inside <span class="op">=</span> <span class="cn">FALSE</span>, filepath<span class="op">=</span><span class="st">"."</span><span class="op">)</span>
<span class="co">#&gt; Warning in raster::projectRaster(friction.map, pop.map): input and ouput crs are</span>
<span class="co">#&gt; the same</span>
<span class="co">#&gt; Warning in raster::projectRaster(access.map, pop.map): input and ouput crs are</span>
<span class="co">#&gt; the same</span>
<span class="co">#&gt; [1] 3</span></code></pre></div>
<p>3 CHWs are needed to cover the area. The package returns a new data.frame with one line per assigned CHW, with the associated GPS coordinates (x and y), whether their are positioned in rural area (is.rural=1 in rural areas and 0 in urban areas), and their associated number of people assigned (capacity). The sum of all CHW capacities is above the total population in the area, due to overlapping catchment areas in this example.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">CHWanswer</span>
<span class="co">#&gt;           x          y is.rural capacity</span>
<span class="co">#&gt; 1 0.7000000 0.23333333        0     1770</span>
<span class="co">#&gt; 2 0.8333333 0.23333333        0      900</span>
<span class="co">#&gt; 3 0.2333333 0.03333333        1      660</span></code></pre></div>
<p>We can represent these results graphically. To improve interpretability, we will plot a masked version of the population raster, where all areas not included in the analysis (following the buffer parameter) are replaced by NA. Such a map can be obtained as one of the outcomes of the function PrepareRasterFiles.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">all.rasters</span><span class="op">=</span><span class="fu"><a href="../reference/PrepareRasterFiles.html">PrepareRasterFiles</a></span><span class="op">(</span>population.raster<span class="op">=</span><span class="va">pop.dummy</span>, friction.raster<span class="op">=</span><span class="va">fric.dummy</span>,shp<span class="op">=</span><span class="va">shp.dummy</span>,
                                        buffer<span class="op">=</span><span class="fl">60</span>, 
                                        access.raster<span class="op">=</span><span class="va">acc.dummy</span>,popurb.raster<span class="op">=</span><span class="va">urb.dummy</span>,
                                        is.inside <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt; Warning in raster::projectRaster(friction.map, pop.map): input and ouput crs are</span>
<span class="co">#&gt; the same</span>
<span class="co">#&gt; Warning in raster::projectRaster(access.map, pop.map): input and ouput crs are</span>
<span class="co">#&gt; the same</span></code></pre></div>
<p>We use the rasters to represent the results graphically:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/gplot-methods.html" class="external-link">gplot</a></span><span class="op">(</span><span class="va">all.rasters</span><span class="op">$</span><span class="va">pop.map</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#FF6600"</span>, <span class="st">"#990000"</span><span class="op">)</span>, name<span class="op">=</span><span class="st">"Population"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">CHWanswer</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="CHWplacement-vignette_files/figure-html/unnamed-chunk-10-1.png" width="480" style="display: block; margin: auto;"> We can also plot the catchment area of each CHW and see that all population points are covered. These cathcment areas correspond to a distance of 600 min (radius) form the CHW location. The catchment areas do overlap, and in practice, they would need to be adapted individually knowing the local geographical context when CHWs are recruited.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">footprint1</span><span class="op">=</span><span class="fu"><a href="../reference/GetFootprintWalkingTime.html">GetFootprintWalkingTime</a></span><span class="op">(</span>pos<span class="op">=</span><span class="va">CHWanswer</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, radius<span class="op">=</span><span class="fl">600</span>, pop.map<span class="op">=</span><span class="va">all.rasters</span><span class="op">$</span><span class="va">pop.map</span>, T.GC<span class="op">=</span><span class="va">all.rasters</span><span class="op">$</span><span class="va">T.GC</span><span class="op">)</span>
<span class="va">footprint1b</span><span class="op">=</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/xyFromCell.html" class="external-link">xyFromCell</a></span><span class="op">(</span><span class="va">all.rasters</span><span class="op">$</span><span class="va">pop.map</span>,<span class="va">footprint1</span><span class="op">)</span>
<span class="va">footprint2</span><span class="op">=</span><span class="fu"><a href="../reference/GetFootprintWalkingTime.html">GetFootprintWalkingTime</a></span><span class="op">(</span>pos<span class="op">=</span><span class="va">CHWanswer</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, radius<span class="op">=</span><span class="fl">600</span>, pop.map<span class="op">=</span><span class="va">all.rasters</span><span class="op">$</span><span class="va">pop.map</span>, T.GC<span class="op">=</span><span class="va">all.rasters</span><span class="op">$</span><span class="va">T.GC</span><span class="op">)</span>
<span class="va">footprint2b</span><span class="op">=</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/xyFromCell.html" class="external-link">xyFromCell</a></span><span class="op">(</span><span class="va">all.rasters</span><span class="op">$</span><span class="va">pop.map</span>,<span class="va">footprint2</span><span class="op">)</span>
<span class="va">footprint3</span><span class="op">=</span><span class="fu"><a href="../reference/GetFootprintWalkingTime.html">GetFootprintWalkingTime</a></span><span class="op">(</span>pos<span class="op">=</span><span class="va">CHWanswer</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, radius<span class="op">=</span><span class="fl">600</span>, pop.map<span class="op">=</span><span class="va">all.rasters</span><span class="op">$</span><span class="va">pop.map</span>, T.GC<span class="op">=</span><span class="va">all.rasters</span><span class="op">$</span><span class="va">T.GC</span><span class="op">)</span>
<span class="va">footprint3b</span><span class="op">=</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/xyFromCell.html" class="external-link">xyFromCell</a></span><span class="op">(</span><span class="va">all.rasters</span><span class="op">$</span><span class="va">pop.map</span>,<span class="va">footprint3</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/gplot-methods.html" class="external-link">gplot</a></span><span class="op">(</span><span class="va">all.rasters</span><span class="op">$</span><span class="va">pop.map</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#FF6600"</span>, <span class="st">"#990000"</span><span class="op">)</span>, name<span class="op">=</span><span class="st">"Population"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">footprint1b</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span><span class="op">)</span>, color<span class="op">=</span><span class="st">"darkblue"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">footprint2b</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span><span class="op">)</span>, color<span class="op">=</span><span class="st">"dodgerblue"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">footprint3b</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span><span class="op">)</span>, color<span class="op">=</span><span class="st">"lightblue"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">CHWanswer</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="CHWplacement-vignette_files/figure-html/unnamed-chunk-11-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="using-the-package-in-practice-with-large-maps">Using the package in practice with large maps<a class="anchor" aria-label="anchor" href="#using-the-package-in-practice-with-large-maps"></a>
</h3>
<p>Solving the model with the R software and the lpSolveAPI package can become very computationally intense for the problems to be solved in practice (larger maps and more difficult optimisation constraints). In this context, other softwares can be used, such as <span class="citation">Gurobi Optimization, LLC (2020)</span> or SCIP (<span class="citation">Gamrath et al. (2020a)</span>, <span class="citation">Gamrath et al. (2020b)</span>).</p>
<div class="section level4">
<h4 id="some-limitations">Some limitations<a class="anchor" aria-label="anchor" href="#some-limitations"></a>
</h4>
<p>Time limitations and size limitation are caused by the creation and .mps by the lpSolveAPI package. For large problems the .mps file creation can be lengthy. Additonally, there can’t be more than 9 999 999 decision variables, because the name of columns i.e. decision variables in .mps have a limited length (after that threshold, C10000001 and C10000002 become C1000000 which raises error).</p>
</div>
<div class="section level4">
<h4 id="using-scip">Using SCIP<a class="anchor" aria-label="anchor" href="#using-scip"></a>
</h4>
<p>SCIP is an open source solver whose performance is greater than lpSolveAPI on large problems. It needs to be downloaded and installed <a href="https://www.scipopt.org/index.php#download" class="external-link">here</a>. You can indicate which version of SCIP was downloaded as follows:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co">############### CHANGE THAT: ##################################</span>

<span class="va">SCIP_version</span> <span class="op">=</span> <span class="st">"7.0.3"</span>

<span class="co">###############################################################</span></code></pre></div>
<p>The CHW plan can be defined similarly to the previous examples, with the following function:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># mps_directory_H2 = file.path("clscp_600_buffer60_capa")</span>

<span class="fu"><a href="../reference/CreateCHWplacement_SCIP.html">CreateCHWplacement_SCIP</a></span><span class="op">(</span> population.raster <span class="op">=</span> <span class="va">pop.dummy</span>,
                       friction.raster  <span class="op">=</span> <span class="va">fric.dummy</span>,
                       access.raster    <span class="op">=</span> <span class="va">acc.dummy</span>,
                       popurb.raster    <span class="op">=</span> <span class="va">urb.dummy</span>,
                       shp <span class="op">=</span> <span class="va">shp.dummy</span>,
                       filepath <span class="op">=</span> <span class="st">"."</span>,
                       name <span class="op">=</span> <span class="st">"SCIPtemp"</span>,
                       buffer <span class="op">=</span> <span class="fl">60</span>, radius <span class="op">=</span> <span class="fl">600</span>, capacity.name<span class="op">=</span><span class="st">""</span>,
                       max.treat.per.CHW.urban <span class="op">=</span> <span class="fl">2000</span>, max.treat.per.CHW.rural <span class="op">=</span> <span class="fl">1000</span>,
                       max.CHW.per.pixel <span class="op">=</span> <span class="fl">10</span>, is.inside <span class="op">=</span> <span class="cn">FALSE</span>,
                       dualitygap <span class="op">=</span> <span class="fl">0</span>,           <span class="co"># a maximum error CHW because global solutions</span>
                       relativegap <span class="op">=</span> <span class="cn">F</span>,          <span class="co"># sometimes can't be caculated in a resonable duration</span>
                       SCIP_version <span class="op">=</span> <span class="va">SCIP_version</span><span class="op">)</span>
<span class="co">#&gt; Warning in raster::projectRaster(friction.map, pop.map): input and ouput crs are</span>
<span class="co">#&gt; the same</span>
<span class="co">#&gt; Warning in raster::projectRaster(access.map, pop.map): input and ouput crs are</span>
<span class="co">#&gt; the same</span>
<span class="co">#&gt; Model name: </span>
<span class="co">#&gt;   a linear program with 2550 decision variables and 100 constraints</span></code></pre></div>
<p>This function will create a file called SCIPtemp.mps, stored in the repository indicated by filepath. This files contains the description of the optimization problem.</p>
<p>Then it will create a .txt file with the basic script you need in order to calculate the solution by using SCIP shell. The two additional options (dualitygap and relativegap are specific SCIP parameters as detailed in the function documentation).</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="kw">cat</span>(<span class="kw">readLines</span>(<span class="st">'clscp_600_buffer60_capa/SCIP_script_SCIPtemp.txt'</span>), <span class="dt">sep =</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="op">**</span><span class="er">***</span><span class="st">  </span>Manual use of SCIP version <span class="dv">7</span>.<span class="fl">0.3</span><span class="op">**</span><span class="er">***</span></span>
<span id="cb14-3"><a href="#cb14-3"></a><span class="er">**</span><span class="st"> </span>Please enter the lines below one by one on the SCIP shell <span class="op">**</span></span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="st"> </span></span>
<span id="cb14-5"><a href="#cb14-5"></a>set limits absgap <span class="dv">0</span></span>
<span id="cb14-6"><a href="#cb14-6"></a>read .<span class="op">/</span>clscp_<span class="dv">600</span>_buffer60_capa<span class="op">/</span>SCIPtemp.mps</span>
<span id="cb14-7"><a href="#cb14-7"></a>optimize</span>
<span id="cb14-8"><a href="#cb14-8"></a>write solution .<span class="op">/</span>clscp_<span class="dv">600</span>_buffer60_capa<span class="op">/</span>SCIPtemp_solutions.sol</span>
<span id="cb14-9"><a href="#cb14-9"></a>quit </span>
<span id="cb14-10"><a href="#cb14-10"></a> </span>
<span id="cb14-11"><a href="#cb14-11"></a> </span>
<span id="cb14-12"><a href="#cb14-12"></a><span class="op">**</span><span class="er">***</span><span class="st">  </span>Automated use of SCIP version <span class="dv">7</span>.<span class="fl">0.3</span>( <span class="cf">for</span> Windows users ) <span class="op">**</span><span class="er">***</span></span>
<span id="cb14-13"><a href="#cb14-13"></a><span class="er">**</span><span class="st"> </span>Please enter the script below <span class="cf">in</span> windows powershell <span class="op">**</span></span>
<span id="cb14-14"><a href="#cb14-14"></a><span class="st"> </span></span>
<span id="cb14-15"><a href="#cb14-15"></a>Start<span class="op">-</span>Process <span class="op">-</span>FilePath <span class="st">'C:/Program Files/SCIPOptSuite 7.0.3/bin/scip.exe'</span></span>
<span id="cb14-16"><a href="#cb14-16"></a><span class="op">$</span>wshell =<span class="st"> </span>New<span class="op">-</span>Object <span class="op">-</span>ComObject wscript.shell</span>
<span id="cb14-17"><a href="#cb14-17"></a><span class="op">$</span><span class="kw">wshell.SendKeys</span>(<span class="st">'%{TAB}'</span>)</span>
<span id="cb14-18"><a href="#cb14-18"></a>Sleep <span class="dv">2</span></span>
<span id="cb14-19"><a href="#cb14-19"></a><span class="op">$</span><span class="kw">wshell.SendKeys</span>( <span class="st">'set limits absgap 0'</span> )</span>
<span id="cb14-20"><a href="#cb14-20"></a><span class="op">$</span><span class="kw">wshell.SendKeys</span>(<span class="st">'~'</span>)</span>
<span id="cb14-21"><a href="#cb14-21"></a>Sleep <span class="fl">.3</span></span>
<span id="cb14-22"><a href="#cb14-22"></a><span class="op">$</span><span class="kw">wshell.SendKeys</span>( <span class="st">'read ./clscp_600_buffer60_capa/SCIPtemp.mps'</span> )</span>
<span id="cb14-23"><a href="#cb14-23"></a><span class="op">$</span><span class="kw">wshell.SendKeys</span>(<span class="st">'~'</span>)</span>
<span id="cb14-24"><a href="#cb14-24"></a>Sleep <span class="dv">1</span></span>
<span id="cb14-25"><a href="#cb14-25"></a><span class="op">$</span><span class="kw">wshell.SendKeys</span>(<span class="st">'optimize'</span> )</span>
<span id="cb14-26"><a href="#cb14-26"></a><span class="op">$</span><span class="kw">wshell.SendKeys</span>(<span class="st">'~'</span>)</span>
<span id="cb14-27"><a href="#cb14-27"></a>Wait<span class="op">-</span>Process <span class="op">-</span>Id <span class="op">$</span>wshell.id</span>
<span id="cb14-28"><a href="#cb14-28"></a><span class="op">$</span><span class="kw">wshell.SendKeys</span>( <span class="st">'write solution ./clscp_600_buffer60_capa/SCIPtemp_solutions.sol'</span> )</span>
<span id="cb14-29"><a href="#cb14-29"></a><span class="op">$</span><span class="kw">wshell.SendKeys</span>(<span class="st">'~'</span>)</span>
<span id="cb14-30"><a href="#cb14-30"></a>Sleep <span class="fl">.5</span></span>
<span id="cb14-31"><a href="#cb14-31"></a><span class="op">$</span><span class="kw">wshell.SendKeys</span>(<span class="st">'quit'</span>)</span>
<span id="cb14-32"><a href="#cb14-32"></a><span class="op">$</span><span class="kw">wshell.SendKeys</span>(<span class="st">'~'</span>)</span></code></pre></div>
<p>This text file contains two parts. The first part (Manual use of SCIP) gives the commands to type in the SCIP command line to solve the problem. The second part (Automated use of SCIP version 7.0.3( for Windows users )) gives a script that can be directly copy-pasted in the Windows powershell to solve the optimisation problem with SCIP. This will create a .sol file in the same repository, containing the solution of the optimisation problem.</p>
<p>If you already have a .mps file, you can use the function <strong>CreateScriptSCIP</strong>, which only creates the .txt file. It can be useful if you want to recreate scripts for an older .mps file.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/CreateScriptSCIP.html">CreateScriptSCIP</a></span><span class="op">(</span> mps_directory <span class="op">=</span> <span class="st">"clscp_600_buffer60_capa"</span>, name <span class="op">=</span> <span class="st">"SCIPtemp"</span>, dualitygap <span class="op">=</span> <span class="fl">0</span>, relativegap <span class="op">=</span> <span class="cn">F</span> <span class="op">)</span></code></pre></div>
<p>Now you have a file temp_solution.sol and the next step is to decode it. Make sure you use exactly the same input rasters as the ones used in <strong>CreateCHWplacement_SCIP</strong>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">CHWanswer</span> <span class="op">=</span> <span class="fu"><a href="../reference/read_CHWplacement_sol_SCIP.html">read_CHWplacement_sol_SCIP</a></span><span class="op">(</span>  population.raster <span class="op">=</span> <span class="va">pop.dummy</span>,
                              friction.raster  <span class="op">=</span> <span class="va">fric.dummy</span>,
                              access.raster    <span class="op">=</span> <span class="va">acc.dummy</span>,
                              popurb.raster    <span class="op">=</span> <span class="va">urb.dummy</span>,
                              shp <span class="op">=</span> <span class="va">shp.dummy</span>,
                              name <span class="op">=</span> <span class="st">"SCIPtemp"</span> ,
                              filepath <span class="op">=</span> <span class="st">"."</span>,
                              buffer<span class="op">=</span><span class="fl">60</span>, is.inside <span class="op">=</span> <span class="cn">F</span>, radius<span class="op">=</span><span class="fl">600</span>, capacity.name <span class="op">=</span> <span class="st">""</span>,
                              write <span class="op">=</span> <span class="cn">F</span>  <span class="co"># creates a CSV file of the results</span>
                              <span class="op">)</span>
<span class="co">#&gt; Warning in raster::projectRaster(friction.map, pop.map): input and ouput crs are</span>
<span class="co">#&gt; the same</span>
<span class="co">#&gt; Warning in raster::projectRaster(access.map, pop.map): input and ouput crs are</span>
<span class="co">#&gt; the same</span></code></pre></div>
<p>This will return a dataframe file containing the CHW positions (it can be saved as .csv file with the option write=T).</p>
<p>3 CHWs are needed to cover the area: the solution is slightly different from the previous one, but it equally verifies the chosen constraints (walking time and capacities).</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">CHWanswer</span>
<span class="co">#&gt;           x          y is.rural capacity</span>
<span class="co">#&gt; 1 0.7000000 0.03333333        0     1290</span>
<span class="co">#&gt; 2 0.2333333 0.03333333        1      600</span>
<span class="co">#&gt; 3 0.7666667 0.10000000        0     1530</span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/gplot-methods.html" class="external-link">gplot</a></span><span class="op">(</span><span class="va">all.rasters</span><span class="op">$</span><span class="va">pop.map</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#FF6600"</span>, <span class="st">"#990000"</span><span class="op">)</span>, name<span class="op">=</span><span class="st">"Population"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">CHWanswer</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="CHWplacement-vignette_files/figure-html/unnamed-chunk-16-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="using-gurobi">Using Gurobi<a class="anchor" aria-label="anchor" href="#using-gurobi"></a>
</h4>
<p>The .mps file created previously can also be solved with Gurobi, and the solution will be provided as a .sol file. This .sol file can be read with R using the function <strong>read_CHWplacement_sol</strong>.</p>
</div>
</div>
</div>
<div class="section level2 unnumbered">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references">
<div id="ref-current_storbeck1988">
<p>Current, John Richard, and James Edward Storbeck. 1988. “Capacitated Covering Models.” <em>Environment and Planning B: Planning and Design</em> 15 (2): 153–63.</p>
</div>
<div id="ref-scip1">
<p>Gamrath, Gerald, Daniel Anderson, Ksenia Bestuzheva, Wei-Kun Chen, Leon Eifler, Maxime Gasse, Patrick Gemander, et al. 2020a. “The SCIP Optimization Suite 7.0.” Technical Report. Optimization Online. <a href="http://www.optimization-online.org/DB_HTML/2020/03/7705.html" class="external-link">http://www.optimization-online.org/DB_HTML/2020/03/7705.html</a>.</p>
</div>
<div id="ref-scip2">
<p>———. 2020b. “The SCIP Optimization Suite 7.0.” ZIB-Report 20-10. Zuse Institute Berlin. <a href="http://nbn-resolving.de/urn:nbn:de:0297-zib-78023" class="external-link">http://nbn-resolving.de/urn:nbn:de:0297-zib-78023</a>.</p>
</div>
<div id="ref-gurobi">
<p>Gurobi Optimization, LLC. 2020. <em>Gurobi Optimizer Reference Manual</em>. <a href="http://www.gurobi.com" class="external-link">http://www.gurobi.com</a>.</p>
</div>
<div id="ref-malariaatlas_package">
<p>Pfeffer, Daniel A., Timothy C. D. Lucas, Daniel May, Joseph Harris, Jennifer Rozier, Katherine A. Twohig, Ursula Dalrymple, et al. 2018. “malariaAtlas : An R Interface to Global Malariometric Data Hosted by the Malaria Atlas Project.” <em>Malaria Journal</em> 17 (1): 1–10. <a href="https://doi.org/10.1186/s12936-018-2500-5" class="external-link">https://doi.org/10.1186/s12936-018-2500-5</a>.</p>
</div>
<div id="ref-world_bank_report">
<p>The World Bank. 2017. “Haitian Cities: Actions for Today with an Eye on Tomorrow.” <a href="http://documents.worldbank.org/curated/en/709121516634280180/pdf/122880-V1-WP-P156561-OUO-9-FINAL-ENGLISH.pdf" class="external-link">http://documents.worldbank.org/curated/en/709121516634280180/pdf/122880-V1-WP-P156561-OUO-9-FINAL-ENGLISH.pdf</a>.</p>
</div>
<div id="ref-weiss2020">
<p>Weiss, D. J., A. Nelson, C. A. Vargas-Ruiz, K. Gligorić, S. Bavadekar, E. Gabrilovich, A. Bertozzi-Villa, et al. 2020. “Global Maps of Travel Time to Healthcare Facilities.” <em>Nature Medicine</em>, September, 1–4. <a href="https://doi.org/10.1038/s41591-020-1059-1" class="external-link">https://doi.org/10.1038/s41591-020-1059-1</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Clara Champagne.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
